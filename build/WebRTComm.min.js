PrivateJainSipMessageConnector=function(a,c,b){if(a instanceof PrivateJainSipClientConnector&&c instanceof WebRTCommMessage){if(typeof(b)==="string"){this.sipCallId=b}else{this.sipCallId=new String(new Date().getTime())}this.clientConnector=a;this.webRTCommMessage=c;this.sipMessageState=undefined}else{throw"PrivateJainSipMessageConnector:PrivateJainSipMessageConnector(): bad arguments"}};PrivateJainSipMessageConnector.prototype.SIP_MESSAGE_SENDING_STATE="SIP_MESSAGE_SENDING_STATE";PrivateJainSipMessageConnector.prototype.SIP_MESSAGE_407_STATE="SIP_MESSAGE_407_STATE";PrivateJainSipMessageConnector.prototype.SIP_MESSAGE_SENT_STATE="SIP_MESSAGE_SENT_STATE";PrivateJainSipMessageConnector.prototype.SIP_MESSAGE_SEND_FAILED_STATE="SIP_MESSAGE_SEND_FAILED_STATE";PrivateJainSipMessageConnector.prototype.SIP_MESSAGE_RECEIVED_STATE="SIP_MESSAGE_RECEIVED_STATE";PrivateJainSipMessageConnector.prototype.getId=function(){return this.sipCallId};PrivateJainSipMessageConnector.prototype.sendAuthenticatedSipMessageRequest=function(g,c){g.removeHeader("Authorization");var f=new SIPRequest();f.setMethod(g.getMethod());f.setRequestURI(g.getRequestURI());var b=g.getHeaders();for(var d=0;d<b.length;d++){f.addHeader(b[d])}var a=new Number(g.getCSeq().getSeqNumber());f.getCSeq().setSeqNumber(a+1);f.setCallId(g.getCallId());f.setVia(this.clientConnector.jainSipListeningPoint.getViaHeader());f.setFrom(g.getFrom());f.setTo(g.getTo());f.setMaxForwards(g.getMaxForwards());if(g.getContent()!==null){var e=g.getContent();var h=g.getContentTypeHeader();f.setContent(e,h)}this.clientConnector.jainSipMessageFactory.addHeader(f,c);jainSipMessageTransaction=this.clientConnector.jainSipProvider.getNewClientTransaction(f);f.setTransaction(jainSipMessageTransaction);jainSipMessageTransaction.sendRequest()};PrivateJainSipMessageConnector.prototype.onJainSipClientConnectorSipRequestEvent=function(a){this.sipMessageState=this.SIP_MESSAGE_RECEIVED_STATE;var c=a.getRequest();var d=c.createResponse(200,"OK");d.addHeader(this.clientConnector.jainSipContactHeader);d.removeHeader("P-Asserted-Identity");d.removeHeader("P-Charging-Vector");d.removeHeader("P-Charging-Function-Addresses");d.removeHeader("P-Called-Party-ID");d.removeContent();a.getServerTransaction().sendResponse(d);this.webRTCommMessage.from=a.getRequest().getHeader("From").getAddress().getURI().getUser();this.webRTCommMessage.text=a.getRequest().getContent();if(this.webRTCommMessage.webRTCommCall){if(this.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageReceivedEvent){var b=this;setTimeout(function(){try{b.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageReceivedEvent(b.webRTCommMessage)}catch(e){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipRequestEvent(): catched exception in event listener:"+e)}},1)}}else{if(this.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageReceivedEvent){var b=this;setTimeout(function(){try{b.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageReceivedEvent(b.webRTCommMessage)}catch(e){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipRequestEvent(): catched exception in event listener:"+e)}},1)}}this.close()};PrivateJainSipMessageConnector.prototype.onJainSipClientConnectorSipResponseEvent=function(e){var f=e.getResponse();var c=parseInt(f.getStatusCode());if(this.sipMessageState===this.SIP_MESSAGE_SENDING_STATE||this.sipMessageState===this.SIP_MESSAGE_407_STATE){if(c>=100&&c<300){this.sipMessageState=this.SIP_MESSAGE_SENT_STATE;if(this.webRTCommMessage.webRTCommCall){if(this.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageSentEvent){var d=this;setTimeout(function(){try{d.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageSentEvent(d.webRTCommMessage)}catch(g){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipResponseEvent(): catched exception in event listener:"+g)}},1)}}else{if(this.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageSentEvent){var d=this;setTimeout(function(){try{d.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageSentEvent(d.webRTCommMessage)}catch(g){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipResponseEvent(): catched exception in event listener:"+g)}},1)}}}else{if(c===407){this.sipMessageState=this.SIP_MESSAGE_407_STATE;var a=e.getOriginalTransaction().getOriginalRequest();var b=this.clientConnector.jainSipHeaderFactory.createAuthorizationHeader(f,a,this.clientConnector.configuration.sipPassword,this.clientConnector.configuration.sipLogin);this.sendAuthenticatedSipMessageRequest(a,b);return}else{this.sipMessageState=this.SIP_MESSAGE_SEND_FAILED_STATE}if(this.webRTCommMessage.webRTCommCall){if(this.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageSendErrorEvent){var d=this;setTimeout(function(){try{d.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageSendErrorEvent(d.webRTCommMessage,f.getStatusLine().getReasonPhrase())}catch(g){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipResponseEvent(): catched exception in event listener:"+g)}},1)}}else{if(this.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageSendErrorEvent){var d=this;setTimeout(function(){try{d.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageSendErrorEvent(d.webRTCommMessage,f.getStatusLine().getReasonPhrase())}catch(g){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipResponseEvent(): catched exception in event listener:"+g)}},1)}}}}else{console.error("PrivateJainSipMessageConnector:onJainSipClientConnectorSipResponseEvent() : bad state : "+this.sipMessageState)}this.close()};PrivateJainSipMessageConnector.prototype.onJainSipClientConnectorSipTimeoutEvent=function(a){if(this.sipMessageState===this.SIP_MESSAGE_SENDING_STATE){this.sipMessageState=this.SIP_MESSAGE_SEND_FAILED_STATE;if(this.webRTCommMessage.webRTCommCall){if(this.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageSendErrorEvent){var b=this;setTimeout(function(){try{b.webRTCommMessage.webRTCommCall.eventListener.onWebRTCommMessageSendErrorEvent(b.webRTCommMessage,"SIP Timeout")}catch(c){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipTimeoutEvent(): catched exception in event listener:"+c)}},1)}}else{if(this.webRTCommMessage.webRTCommClient.eventListener.onWebRTCommMessageSendErrorEvent){var b=this;setTimeout(function(){try{b.webRTCommClient.eventListener.onWebRTCommMessageSendErrorEvent(b.webRTCommMessage,"SIP Timeout")}catch(c){console.error("PrivateJainSipClientConnector:onJainSipClientConnectorSipTimeoutEvent(): catched exception in event listener:"+c)}},1)}}}else{console.error("PrivateJainSipMessageConnector:onJainSipClientConnectorSipTimeoutEvent() : bad state : "+this.sipMessageState)}this.close()};PrivateJainSipMessageConnector.prototype.close=function(){this.clientConnector.removeSessionConnector(this.sipCallId)};PrivateJainSipMessageConnector.prototype.send=function(){if(this.sipMessageState===undefined){var m=this.webRTCommMessage.to;if(m.indexOf("@")===-1){m+="@"+this.clientConnector.configuration.sipDomain}var a=this.clientConnector.configuration.sipUserName+"@"+this.clientConnector.configuration.sipDomain;var k=this.clientConnector.jainSipHeaderFactory.createCSeqHeader(1,"MESSAGE");var q=this.clientConnector.jainSipHeaderFactory.createCallIdHeader(this.sipCallId);var g=this.clientConnector.jainSipHeaderFactory.createMaxForwardsHeader(70);var d=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,m);var i=this.clientConnector.jainSipHeaderFactory.createHeaders("Allow: INVITE,ACK,CANCEL,BYE,MESSAGE");var b=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,a);var f=this.clientConnector.jainSipAddressFactory.createAddress_name_uri(this.clientConnector.configuration.displayName,b);if(this.clientConnector.configuration.displayName){f.setDisplayName(this.clientConnector.configuration.displayName)}else{if(this.clientConnector.configuration.sipDisplayName){f.setDisplayName(this.clientConnector.configuration.sipDisplayName)}}var o=new Date().getTime();var h=this.clientConnector.jainSipHeaderFactory.createFromHeader(f,o);var n=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,m);var c=this.clientConnector.jainSipAddressFactory.createAddress_name_uri(null,n);var e=this.clientConnector.jainSipHeaderFactory.createToHeader(c,null);var l=this.clientConnector.jainSipListeningPoint.getViaHeader();var p=this.clientConnector.jainSipHeaderFactory.createContentTypeHeader("text","plain");this.jainSipMessageRequest=this.clientConnector.jainSipMessageFactory.createRequest(d,"MESSAGE",q,k,h,e,l,g,p,this.webRTCommMessage.text);this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipMessageRequest,i);this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipMessageRequest,this.clientConnector.jainSipContactHeader);var j=this.clientConnector.jainSipProvider.getNewClientTransaction(this.jainSipMessageRequest);this.jainSipMessageRequest.setTransaction(j);j.sendRequest();this.sipMessageState=this.SIP_MESSAGE_SENDING_STATE}else{console.error("PrivateJainSipMessageConnector:send(): bad state, unauthorized action");throw"PrivateJainSipMessageConnector:send(): bad state, unauthorized action"}};PrivateJainSipCallConnector=function(a,c,b){if(a instanceof PrivateJainSipClientConnector&&c instanceof WebRTCommCall){if(typeof(b)==="string"){this.sipCallId=b}else{this.sipCallId=new String(new Date().getTime())}this.clientConnector=a;this.webRTCommCall=c;this.webRTCommCall.id=this.sipCallId;this.configuration=undefined;this.resetSipContext()}else{throw"PrivateJainSipCallConnector:PrivateJainSipCallConnector(): bad arguments"}};PrivateJainSipCallConnector.prototype.SIP_INVITING_INITIAL_STATE="INVITING_INITIAL_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_STATE="INVITING_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_407_STATE="INVITING_407_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_ACCEPTED_STATE="INVITING_ACCEPTED_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_LOCAL_HANGINGUP_STATE="INVITING_LOCAL_HANGINGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_LOCAL_HANGINGUP_407_STATE="INVITING_LOCAL_HANGINGUP_407_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_CANCELLING_STATE="INVITING_CANCELLING_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_ERROR_STATE="INVITING_ERROR_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_HANGUP_STATE="INVITING_HANGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_CANCELLED_STATE="SIP_INVITING_CANCELLED_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_INITIAL_STATE="INVITED_INITIAL_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_ACCEPTED_STATE="INVITED_ACCEPTED_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_LOCAL_HANGINGUP_STATE="INVITED_LOCAL_HANGINGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_LOCAL_HANGINGUP_407_STATE="INVITED_LOCAL_HANGINGUP_407_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_HANGUP_STATE="INVITED_HANGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_ERROR_STATE="INVITED_ERROR_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_CANCELLED_STATE="INVITING_HANGUP_STATE";PrivateJainSipCallConnector.prototype.isOpened=function(){return((this.sipCallState===this.SIP_INVITING_ACCEPTED_STATE)||(this.sipCallState===this.SIP_INVITED_ACCEPTED_STATE))};PrivateJainSipCallConnector.prototype.getId=function(){return this.sipCallId};PrivateJainSipCallConnector.prototype.open=function(a){if(this.sipCallState===undefined){if(typeof(a)==="object"){if(this.checkConfiguration(a)===true){this.sipCallState=this.SIP_INVITING_INITIAL_STATE;this.configuration=a}else{console.error("PrivateJainSipCallConnector:open(): bad configuration");throw"PrivateJainSipCallConnector:open(): bad configuration"}}else{this.sipCallState=this.SIP_INVITED_INITIAL_STATE}}else{console.error("PrivateJainSipCallConnector:open(): bad state, unauthorized action");throw"PrivateJainSipCallConnector:open(): bad state, unauthorized action"}};PrivateJainSipCallConnector.prototype.close=function(){if(this.sipCallState!==undefined){try{if(this.sipCallState===this.SIP_INITIAL_INVITING_STATE){this.resetSipContext();this.clientConnector.removeSessionConnector(this.sipCallId);this.webRTCommCall.onPrivateCallConnectorCallClosedEvent()}else{if(this.sipCallState===this.SIP_INVITING_STATE||this.sipCallState===this.SIP_INVITING_407_STATE){this.jainSipInvitingCancelRequest=this.jainSipInvitingTransaction.createCancel();this.jainSipInvitingCancelRequest.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitingCancelTransaction=this.clientConnector.jainSipProvider.getNewClientTransaction(this.jainSipInvitingCancelRequest);this.jainSipInvitingCancelTransaction.sendRequest();this.sipCallState=this.SIP_INVITING_CANCELLING_STATE}else{if(this.sipCallState===this.SIP_INVITING_ACCEPTED_STATE){var c=this.jainSipInvitingDialog.createRequest("BYE");c.removeHeader("Contact");c.removeHeader("User-Agent");c.addHeader(this.clientConnector.jainSipContactHeader);var a=this.clientConnector.jainSipProvider.getNewClientTransaction(c);this.jainSipInvitingDialog.sendRequest(a);this.sipCallState=this.SIP_INVITING_LOCAL_HANGINGUP_STATE;this.webRTCommCall.onPrivateCallConnectorCallClosedEvent()}else{if(this.sipCallState===this.SIP_INVITED_INITIAL_STATE){var d=this.jainSipInvitedRequest.createResponse(480,"Temporarily Unavailable");d.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitedTransaction.sendResponse(d);this.resetSipContext();this.clientConnector.removeSessionConnector(this.sipCallId)}else{if(this.sipCallState===this.SIP_INVITED_ACCEPTED_STATE){var c=this.jainSipInvitedDialog.createRequest("BYE");c.removeHeader("Contact");c.removeHeader("User-Agent");c.addHeader(this.clientConnector.jainSipContactHeader);var a=this.clientConnector.jainSipProvider.getNewClientTransaction(c);this.jainSipInvitedDialog.sendRequest(a);this.sipCallState=this.SIP_INVITED_LOCAL_HANGINGUP_STATE}else{this.resetSipContext();this.clientConnector.removeSessionConnector(this.sipCallId);this.webRTCommCall.onPrivateCallConnectorCallClosedEvent()}}}}}}catch(b){console.error("PrivateJainSipCallConnector:close(): catched exception:"+b);this.resetSipContext();this.clientConnector.removeSessionConnector(this.sipCallId);this.webRTCommCall.onPrivateCallConnectorCallClosedEvent()}}};PrivateJainSipCallConnector.prototype.reject=function(){if(this.sipCallState===this.SIP_INVITED_INITIAL_STATE){try{var a=this.jainSipInvitedRequest.createResponse(486,"Busy here");a.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitedTransaction.sendResponse(a)}catch(b){console.error("PrivateJainSipCallConnector:reject(): catched exception:"+b)}this.close()}else{console.error("PrivateJainSipCallConnector:reject(): bad state, unauthorized action");throw"PrivateJainSipCallConnector:reject(): bad state, unauthorized action"}};PrivateJainSipCallConnector.prototype.ignore=function(){if(this.sipCallState===this.SIP_INVITED_INITIAL_STATE){try{this.resetSipContext();this.clientConnector.removeSessionConnector(this.sipCallId);this.webRTCommCall.onPrivateCallConnectorCallClosedEvent()}catch(a){console.error("PrivateJainSipCallConnector:ignore(): catched exception:"+a)}this.close()}else{console.error("PrivateJainSipCallConnector:ignore(): bad state, unauthorized action");throw"PrivateJainSipCallConnector:ignore(): bad state, unauthorized action"}};PrivateJainSipCallConnector.prototype.checkConfiguration=function(b){var a=true;return a};PrivateJainSipCallConnector.prototype.resetSipContext=function(){this.sipCallState=undefined;this.sdpOffer=undefined;this.jainSipInvitingSentRequest=undefined;this.jainSipInvitingDialog=undefined;this.jainSipInvitingTransaction=undefined;this.jainSipInvitedReceivedRequest=undefined;this.jainSipInvitedDialog=undefined;this.jainSipInvitedTransaction=undefined};PrivateJainSipCallConnector.prototype.invite=function(a){this.sdpOffer=a;this.sendSipInviteRequest(a);this.sipCallState=this.SIP_INVITING_STATE};PrivateJainSipCallConnector.prototype.accept=function(a){var b=this.jainSipInvitedRequest.createResponse(200,"OK");b.addHeader(this.clientConnector.jainSipContactHeader);b.setMessageContent("application","sdp",a);this.jainSipInvitedTransaction.sendResponse(b);this.sipCallState=this.SIP_INVITED_ACCEPTED_STATE};PrivateJainSipCallConnector.prototype.onJainSipClientConnectorSipRequestEvent=function(a){if(this.jainSipInvitingDialog!==undefined){this.processInvitingSipRequestEvent(a)}else{if(this.jainSipInvitedDialog!==undefined){this.processInvitedSipRequestEvent(a)}else{this.processInvitedSipRequestEvent(a)}}};PrivateJainSipCallConnector.prototype.onJainSipClientConnectorSipResponseEvent=function(a){if(this.jainSipInvitingDialog!==undefined){this.processInvitingSipResponseEvent(a)}else{if(this.jainSipInvitedDialog!==undefined){this.processInvitedSipResponseEvent(a)}else{}}};PrivateJainSipCallConnector.prototype.onJainSipClientConnectorSipTimeoutEvent=function(a){this.close()};PrivateJainSipCallConnector.prototype.processInvitingSipRequestEvent=function(a){var c=a.getRequest();var d=c.getMethod();if(this.sipCallState===this.SIP_INVITING_INITIAL_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState===this.SIP_INVITING_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState===this.SIP_INVITING_407_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState===this.SIP_INVITING_ERROR_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState===this.SIP_INVITING_ACCEPTED_STATE){if(d==="BYE"){try{var e=c.createResponse(200,"OK");e.addHeader(this.clientConnector.jainSipContactHeader);a.getServerTransaction().sendResponse(e);this.sipCallState=this.SIP_INVITING_HANGUP_STATE}catch(b){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception exception:"+b)}this.webRTCommCall.onPrivateCallConnectorCallHangupEvent();this.close()}else{console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}}else{console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}}}}}};PrivateJainSipCallConnector.prototype.sendSipInviteRequest=function(){var f=this.webRTCommCall.getCalleePhoneNumber();if(f.indexOf("@")===-1){f+="@"+this.clientConnector.configuration.sipDomain}var a=this.clientConnector.configuration.sipUserName+"@"+this.clientConnector.configuration.sipDomain;var k=this.clientConnector.jainSipHeaderFactory.createCSeqHeader(1,"INVITE");var p=this.clientConnector.jainSipHeaderFactory.createCallIdHeader(this.sipCallId);var h=this.clientConnector.jainSipHeaderFactory.createMaxForwardsHeader(70);var d=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,f);var j=this.clientConnector.jainSipHeaderFactory.createHeaders("Allow: INVITE,ACK,CANCEL,BYE");var b=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,a);var g=this.clientConnector.jainSipAddressFactory.createAddress_name_uri(this.configuration.displayName,b);if(this.configuration.displayName){g.setDisplayName(this.configuration.displayName)}else{if(this.clientConnector.configuration.sipDisplayName){g.setDisplayName(this.clientConnector.configuration.sipDisplayName)}}var n=new Date().getTime();var i=this.clientConnector.jainSipHeaderFactory.createFromHeader(g,n);var m=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,f);var c=this.clientConnector.jainSipAddressFactory.createAddress_name_uri(null,m);var e=this.clientConnector.jainSipHeaderFactory.createToHeader(c,null);var l=this.clientConnector.jainSipListeningPoint.getViaHeader();var o=this.clientConnector.jainSipHeaderFactory.createContentTypeHeader("application","sdp");this.jainSipInvitingRequest=this.clientConnector.jainSipMessageFactory.createRequest(d,"INVITE",p,k,i,e,l,h,o,this.sdpOffer);this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipInvitingRequest,j);this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipInvitingRequest,this.clientConnector.jainSipContactHeader);this.jainSipInvitingTransaction=this.clientConnector.jainSipProvider.getNewClientTransaction(this.jainSipInvitingRequest);this.jainSipInvitingRequest.setTransaction(this.jainSipInvitingTransaction);this.jainSipInvitingDialog=this.jainSipInvitingTransaction.getDialog();this.jainSipInvitingTransaction.sendRequest()};PrivateJainSipCallConnector.prototype.sendAuthenticatedSipInviteRequest=function(d){this.jainSipInvitingRequest.removeHeader("Authorization");var a=new SIPRequest();a.setMethod(this.jainSipInvitingRequest.getMethod());a.setRequestURI(this.jainSipInvitingRequest.getRequestURI());var c=this.jainSipInvitingRequest.getHeaders();for(var e=0;e<c.length;e++){a.addHeader(c[e])}var b=new Number(this.jainSipInvitingRequest.getCSeq().getSeqNumber());a.getCSeq().setSeqNumber(b+1);a.setCallId(this.jainSipInvitingRequest.getCallId());a.setVia(this.clientConnector.jainSipListeningPoint.getViaHeader());a.setFrom(this.jainSipInvitingRequest.getFrom());a.setTo(this.jainSipInvitingRequest.getTo());a.setMaxForwards(this.jainSipInvitingRequest.getMaxForwards());if(this.jainSipInvitingRequest.getContent()!==null){var f=this.jainSipInvitingRequest.getContent();var g=this.jainSipInvitingRequest.getContentTypeHeader();a.setContent(f,g)}this.jainSipInvitingRequest=a;this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipInvitingRequest,d);this.jainSipInvitingTransaction=this.clientConnector.jainSipProvider.getNewClientTransaction(this.jainSipInvitingRequest);this.jainSipInvitingRequest.setTransaction(this.jainSipInvitingransaction);this.jainSipInvitingTransaction.sendRequest()};PrivateJainSipCallConnector.prototype.processInvitingSipResponseEvent=function(b){var g=b.getResponse();var d=parseInt(g.getStatusCode());if(this.sipCallState===this.SIP_INVITING_STATE){if(d<200){if(d===180){this.webRTCommCall.onPrivateCallConnectorCallRingingBackEvent()}else{if(d===183){this.webRTCommCall.onPrivateCallConnectorCallInProgressEvent()}}}else{if(d===407){var i=this.clientConnector.jainSipHeaderFactory.createAuthorizationHeader(g,this.jainSipInvitingRequest,this.clientConnector.configuration.sipPassword,this.clientConnector.configuration.sipLogin);this.sendAuthenticatedSipInviteRequest(i);this.sipCallState=this.SIP_INVITING_407_STATE}else{if(d===200){this.jainSipInvitingDialog=b.getOriginalTransaction().getDialog();try{this.jainSipInvitingDialog.setRemoteTarget(g.getHeader("Contact"));var e=this.jainSipInvitingTransaction.createAck();e.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitingDialog.sendAck(e);this.sipCallState=this.SIP_INVITING_ACCEPTED_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c)}try{var f=g.getContent();this.webRTCommCall.onPrivateCallConnectorRemoteSdpAnswerEvent(f)}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c);this.webRTCommCall.onPrivateCallConnectorCallOpenErrorEvent(c);this.close()}}else{console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): SIP INVITE failed:"+g.getStatusCode()+"  "+g.getStatusLine().toString());this.sipCallState=this.SIP_INVITING_ERROR_STATE;this.webRTCommCall.onPrivateCallConnectorCallOpenErrorEvent(g.getStatusLine().getReasonPhrase());this.close()}}}}else{if(this.sipCallState===this.SIP_INVITING_CANCELLING_STATE){this.sipCallState=this.SIP_INVITING_CANCELLED_STATE;this.close()}else{if(this.sipCallState===this.SIP_INVITING_407_STATE){if(d<200){}else{if(d===200){this.jainSipInvitingDialog=b.getOriginalTransaction().getDialog();try{this.jainSipInvitingDialog.setRemoteTarget(g.getHeader("Contact"));var e=this.jainSipInvitingTransaction.createAck();e.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitingDialog.sendAck(e);this.sipCallState=this.SIP_INVITING_ACCEPTED_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c)}try{var f=g.getContent();this.webRTCommCall.onPrivateCallConnectorRemoteSdpAnswerEvent(f)}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c);this.webRTCommCall.onPrivateCallConnectorCallOpenErrorEvent(c);this.close()}}else{this.sipCallState=this.SIP_INVITING_ERROR_STATE;this.webRTCommCall.onPrivateCallConnectorCallOpenErrorEvent(g.getStatusLine().getReasonPhrase());this.close()}}}else{if(this.sipCallState===this.SIP_INVITING_ERROR_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState===this.SIP_INVITING_ACCEPTED_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState===this.SIP_INVITING_LOCAL_HANGINGUP_STATE){if(d===407){try{var a=this.jainSipInvitingDialog.createRequest("BYE");var h=this.clientConnector.jainSipProvider.getNewClientTransaction(a);var i=this.clientConnector.jainSipHeaderFactory.createAuthorizationHeader(g,a,this.clientConnector.configuration.sipPassword,this.clientConnector.configuration.sipLogin);this.clientConnector.jainSipMessageFactory.addHeader(a,i);this.jainSipInvitingDialog.sendRequest(h);this.sipCallState=this.SIP_INVITING_HANGINGUP_407_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c);this.close()}}else{this.close()}}else{if(this.sipCallState===this.SIP_INVITING_LOCAL_HANGINGUP_407_STATE){this.close()}else{console.error("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): bad state, SIP response ignored")}}}}}}}};PrivateJainSipCallConnector.prototype.processInvitedSipRequestEvent=function(c){var a=c.getRequest();var e=a.getMethod();var d=a.getHeader("From");if(this.sipCallState===this.SIP_INVITED_INITIAL_STATE){if(e==="INVITE"){try{this.jainSipInvitedRequest=a;this.jainSipInvitedTransaction=c.getServerTransaction();this.jainSipInvitedDialog=c.getServerTransaction().getDialog();var j=a.createResponse(180,"Ringing");j.addHeader(this.clientConnector.jainSipContactHeader);c.getServerTransaction().sendResponse(j)}catch(b){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): catched exception, exception:"+b)}this.webRTCommCall.onPrivateCallConnectorRemoteSdpOfferEvent(this.jainSipInvitedRequest.getContent());var h=d.getAddress().getURI().getUser();var i=d.getAddress().getDisplayName();this.webRTCommCall.onPrivateCallConnectorCallRingingEvent(h,i)}else{if(e==="CANCEL"){try{var f=a.createResponse(200,"OK");f.addHeader(this.clientConnector.jainSipContactHeader);c.getServerTransaction().sendResponse(f);var g=this.jainSipInvitedRequest.createResponse(487,"(Request Cancelled)");this.jainSipInvitedTransaction.sendMessage(g);this.sipCallState=this.SIP_INVITED_CANCELLED_STATE;this.webRTCommCall.onPrivateCallConnectorCallCanceledEvent()}catch(b){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): catched exception, exception:"+b)}this.webRTCommCall.onPrivateCallConnectorCallHangupEvent();this.close()}else{console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}}}else{if(this.sipCallState===this.SIP_INVITED_ACCEPTED_STATE){if(e==="BYE"){try{var f=a.createResponse(200,"OK");f.addHeader(this.clientConnector.jainSipContactHeader);c.getServerTransaction().sendResponse(f);this.sipCallState=this.SIP_INVITED_HANGUP_STATE}catch(b){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): catched exception exception:"+b)}this.webRTCommCall.onPrivateCallConnectorCallHangupEvent();this.close()}else{if(e==="ACK"){this.jainSipInvitedDialog=c.getServerTransaction().getDialog()}else{console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}}}else{if(this.sipCallState===this.SIP_INVITED_LOCAL_HANGINGUP_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState===this.SIP_INVITED_LOCAL_HANGINGUP_407_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}}}}};PrivateJainSipCallConnector.prototype.processInvitedSipResponseEvent=function(f){var g=f.getResponse();var e=parseInt(g.getStatusCode());if(this.sipCallState===this.SIP_INVITED_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState===this.SIP_INVITED_ACCEPTED_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState===this.SIP_INVITED_LOCAL_HANGINGUP_STATE){if(e===407){try{var d=this.jainSipInvitedDialog.createRequest("BYE");var a=this.jainSipProvider.getNewClientTransaction(d);var b=this.jainSipHeaderFactory.createAuthorizationHeader(g,d,this.configuration.sipPassword,this.configuration.sipLogin);this.jainSipMessageFactory.addHeader(d,b);d.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitedDialog.sendRequest(a);this.sipCallState=this.SIP_INVITED_HANGINGUP_407_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): catched exception, exception:"+c);this.close()}}else{this.close()}}else{if(this.sipCallState===this.SIP_INVITED_LOCAL_HANGINGUP_407_STATE){this.close()}else{console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): bad state, SIP request ignored")}}}}};PrivateJainSipClientConnector=function(a){if(a instanceof WebRTCommClient){this.webRTCommClient=a;this.reset()}else{throw"PrivateJainSipClientConnector:PrivateJainSipClientConnector(): bad arguments"}};PrivateJainSipClientConnector.prototype.SIP_ALLOW_HEADER="Allow: INVITE,ACK,CANCEL,BYE,OPTIONS,MESSAGE";PrivateJainSipClientConnector.prototype.SIP_UNREGISTERED_STATE="SIP_UNREGISTERED_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTERING_STATE="SIP_REGISTERING_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTER_REFRESHING_STATE="SIP_REGISTER_REFRESHING_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTERING_401_STATE="SIP_REGISTERING_401_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTERED_STATE="SIP_REGISTERED_STATE";PrivateJainSipClientConnector.prototype.SIP_UNREGISTERING_401_STATE="SIP_UNREGISTERING_401_STATE";PrivateJainSipClientConnector.prototype.SIP_UNREGISTERING_STATE="SIP_UNREGISTERING_STATE";PrivateJainSipClientConnector.prototype.SIP_SESSION_EXPIRATION_TIMER=3600;PrivateJainSipClientConnector.prototype.isOpened=function(){return this.openedFlag};PrivateJainSipClientConnector.prototype.open=function(f){try{if(typeof(f)==="object"){if(this.openedFlag===false){if(this.checkConfiguration(f)===true){this.configuration=f;this.jainSipFactory=new SipFactory();this.jainSipStack=this.jainSipFactory.createSipStack(this.configuration.sipUserAgent);this.jainSipListeningPoint=this.jainSipStack.createListeningPoint(this.configuration.sipOutboundProxy);this.jainSipProvider=this.jainSipStack.createSipProvider(this.jainSipListeningPoint);this.jainSipProvider.addSipListener(this);this.jainSipHeaderFactory=this.jainSipFactory.createHeaderFactory();this.jainSipAddressFactory=this.jainSipFactory.createAddressFactory();this.jainSipMessageFactory=this.jainSipFactory.createMessageFactory();this.jainSipContactHeader=this.jainSipListeningPoint.createContactHeader(this.configuration.sipUserName);if(this.configuration.sipUserAgentCapabilities){this.jainSipContactHeader.setParameter(this.configuration.sipUserAgentCapabilities,null)}if(this.configuration.sipUriContactParameters){try{var e=this.jainSipContactHeader.getAddress().getURI();var d=this.configuration.sipUriContactParameters.split(";");for(var c=0;c<d.length;c++){var a=d[c].split("=");e.uriParms.set_nv(new NameValue(a[0],a[1]))}}catch(b){console.error("PrivateJainSipClientConnector:open(): catched exception:"+b)}}this.jainSipMessageFactory.setDefaultUserAgentHeader(this.jainSipHeaderFactory.createUserAgentHeader(this.jainSipStack.getUserAgent()));this.jainSipStack.start()}else{console.error("PrivateJainSipClientConnector:open(): bad configuration");throw"PrivateJainSipClientConnector:open(): bad configuration"}}else{console.error("PrivateJainSipClientConnector:open(): bad state, unauthorized action");throw"PrivateJainSipClientConnector:open(): bad state, unauthorized action"}}else{console.error("PrivateJainSipClientConnector:open(): bad argument, check API documentation");throw"PrivateJainSipClientConnector:open(): bad argument, check API documentation"}}catch(b){this.reset();console.error("PrivateJainSipClientConnector:open(): catched exception:"+b);throw b}};PrivateJainSipClientConnector.prototype.close=function(){try{if(this.openedFlag===true){for(var a in this.sessionConnectors){var b=this.sessionConnectors[a];if(b instanceof PrivateJainSipCallConnector){if(b.isOpened()){b.close()}}}if(this.configuration.sipRegisterMode===true){if(this.sipRegisterState===this.SIP_REGISTERED_STATE){this.sipUnregisterPendingFlag=false;this.sipRegisterState=this.SIP_UNREGISTERING_STATE;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sendNewSipRegisterRequest(0)}else{this.sipUnregisterPendingFlag=true}}else{this.reset();this.webRTCommClient.onPrivateClientConnectorClosedEvent()}}else{console.error("PrivateJainSipClientConnector:close(): bad state, unauthorized action");throw"PrivateJainSipClientConnector:close(): bad state, unauthorized action"}}catch(c){console.error("PrivateJainSipClientConnector:close(): catched exception:"+c);throw c}};PrivateJainSipClientConnector.prototype.createPrivateSessionConnector=function(b,a){try{if(this.openedFlag===true){if(b instanceof WebRTCommCall){var c=new PrivateJainSipCallConnector(this,b,a);this.sessionConnectors[c.sipCallId]=c;return c}else{if(b instanceof WebRTCommMessage){var c=new PrivateJainSipMessageConnector(this,b,a);this.sessionConnectors[c.sipCallId]=c;return c}else{console.error("PrivateJainSipClientConnector:createPrivateSessionConnector(): bad argument, check API documentation");throw"PrivateJainSipClientConnector:createPrivateSessionConnector(): bad argument, check API documentation"}}}console.error("PrivateJainSipClientConnector:createPrivateSessionConnector(): bad state, unauthorized action");throw"PrivateJainSipClientConnector:createPrivateSessionConnector(): bad state, unauthorized action"}catch(d){console.error("PrivateJainSipClientConnector:createPrivateSessionConnector(): catched exception:"+d);throw d}};PrivateJainSipClientConnector.prototype.removeSessionConnector=function(a){delete this.sessionConnectors[a]};PrivateJainSipClientConnector.prototype.reset=function(){this.openedFlag=false;this.configuration=undefined;this.resetSipRegisterContext();this.sessionConnectors={}};PrivateJainSipClientConnector.prototype.resetSipRegisterContext=function(){if(this.sipRegisterRefreshTimer!==undefined){clearTimeout(this.sipRegisterRefreshTimer)}this.sipRegisterState=this.SIP_UNREGISTERED_STATE;this.sipRegisterRefreshTimer=undefined;this.sipRegisterAuthenticatedFlag=false;this.jainSipRegisterRequest=undefined;this.jainSipRegisterTransaction=undefined;this.jainSipRegisterDialog=undefined;this.sipUnregisterPendingFlag=false};PrivateJainSipClientConnector.prototype.checkConfiguration=function(c){try{var a=true;if(c.sipUserAgent===undefined||c.sipUserAgent.length===0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipUserAgent")}if(c.sipOutboundProxy===undefined||c.sipOutboundProxy.length===0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipOutboundProxy")}if(c.sipDomain===undefined||c.sipDomain.length===0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipDomain")}if(c.sipUserName===undefined||c.sipUserName.length===0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipUserName")}if(c.sipRegisterMode===undefined||c.sipRegisterMode.length===0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipRegisterMode")}if(c.sipLogin!==undefined&&c.sipLogin===""){c.sipLogin=undefined}if(c.sipPassword!==undefined&&c.sipPassword===""){c.sipPassword=undefined}if(c.sipUserAgentCapabilities!==undefined&&c.sipUserAgentCapabilities===""){c.sipUserAgentCapabilities=undefined}return a}catch(b){console.error("PrivateJainSipClientConnector:checkConfiguration(): catched exception:"+b);return false}};PrivateJainSipClientConnector.prototype.processConnected=function(){try{if(this.openedFlag===false){if(this.configuration.sipRegisterMode===true){this.resetSipRegisterContext();this.sendNewSipRegisterRequest(this.SIP_SESSION_EXPIRATION_TIMER);this.sipRegisterState=this.SIP_REGISTERING_STATE;return}else{this.openedFlag=true;this.webRTCommClient.onPrivateClientConnectorOpenedEvent();return}}else{console.error("PrivateJainSipClientConnector:processConnected(): this.openedFlag==true !")}this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent()}catch(a){this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent();console.error("PrivateJainSipClientConnector:processConnected(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.sendNewSipRegisterRequest=function(m){var a=this.configuration.sipUserName+"@"+this.configuration.sipDomain;var k=this.jainSipHeaderFactory.createCSeqHeader(1,"REGISTER");var o=this.jainSipHeaderFactory.createCallIdHeader(new String(new Date().getTime()));var c=this.jainSipHeaderFactory.createExpiresHeader(m);var g=this.jainSipHeaderFactory.createMaxForwardsHeader(70);var d=this.jainSipAddressFactory.createSipURI_user_host(null,this.configuration.sipDomain);var j=this.jainSipHeaderFactory.createHeaders(PrivateJainSipClientConnector.prototype.SIP_ALLOW_HEADER);var b=this.jainSipAddressFactory.createSipURI_user_host(null,a);var h=this.jainSipAddressFactory.createAddress_name_uri(null,b);var e=new Date();var n=e.getTime();var i=this.jainSipHeaderFactory.createFromHeader(h,n);var f=this.jainSipHeaderFactory.createToHeader(h,null);var l=this.jainSipListeningPoint.getViaHeader();this.jainSipRegisterRequest=this.jainSipMessageFactory.createRequest(d,"REGISTER",o,k,i,f,l,g);this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,c);this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,j);this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,this.jainSipContactHeader);this.jainSipRegisterTransaction=this.jainSipProvider.getNewClientTransaction(this.jainSipRegisterRequest);this.jainSipRegisterDialog=this.jainSipRegisterTransaction.getDialog();this.jainSipRegisterRequest.setTransaction(this.jainSipRegisterTransaction);this.jainSipRegisterTransaction.sendRequest()};PrivateJainSipClientConnector.prototype.sendAuthenticatedSipRegisterRequest=function(d){this.jainSipRegisterRequest.removeHeader("Authorization");var a=new SIPRequest();a.setMethod(this.jainSipRegisterRequest.getMethod());a.setRequestURI(this.jainSipRegisterRequest.getRequestURI());var c=this.jainSipRegisterRequest.getHeaders();for(var e=0;e<c.length;e++){a.addHeader(c[e])}var b=new Number(this.jainSipRegisterRequest.getCSeq().getSeqNumber());a.getCSeq().setSeqNumber(b+1);a.setCallId(this.jainSipRegisterRequest.getCallId());a.setVia(this.jainSipListeningPoint.getViaHeader());a.setFrom(this.jainSipRegisterRequest.getFrom());a.setTo(this.jainSipRegisterRequest.getTo());a.setMaxForwards(this.jainSipRegisterRequest.getMaxForwards());this.jainSipRegisterRequest=a;this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,d);this.jainSipRegisterTransaction=this.jainSipProvider.getNewClientTransaction(this.jainSipRegisterRequest);this.jainSipRegisterRequest.setTransaction(this.jainSipRegisterTransaction);this.jainSipRegisterTransaction.sendRequest()};PrivateJainSipClientConnector.prototype.processDisconnected=function(){try{this.reset();this.webRTCommClient.onPrivateClientConnectorClosedEvent()}catch(a){console.error("PrivateJainSipClientConnector:processDisconnected(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.processConnectionError=function(a){try{this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent()}catch(b){console.error("PrivateJainSipClientConnector:processConnectionError(): catched exception:"+b)}};PrivateJainSipClientConnector.prototype.processRequest=function(d){try{var a=d.getRequest();var g=a.getMethod();if(g==="OPTIONS"){this.processSipOptionRequest(d)}else{var k=a.getCallId().getCallId();var f=this.sessionConnectors[k];if(f){f.onJainSipClientConnectorSipRequestEvent(d)}else{if(g==="INVITE"){var c=new WebRTCommCall(this.webRTCommClient);c.incomingCallFlag=true;c.connector=this.createPrivateSessionConnector(c,k);c.id=c.connector.getId();c.connector.sipCallState=PrivateJainSipCallConnector.prototype.SIP_INVITED_INITIAL_STATE;c.connector.onJainSipClientConnectorSipRequestEvent(d)}else{if(g==="MESSAGE"){var i=undefined;var j=d.getRequest().getHeader("From").getAddress().getURI().getUser();for(var e in this.sessionConnectors){var f=this.sessionConnectors[e];if(f instanceof PrivateJainSipCallConnector){if(f.isOpened()){if(f.webRTCommCall.isIncoming()&&f.webRTCommCall.callerPhoneNumber===j){i=f.webRTCommCall;break}else{if(f.webRTCommCall.calleePhoneNumber===j){i=f.webRTCommCall;break}}}}}var h=new WebRTCommMessage(this.webRTCommClient,i);h.connector.onJainSipClientConnectorSipRequestEvent(d)}else{}}}}}catch(b){console.error("PrivateJainSipClientConnector:processRequest(): catched exception:"+b)}};PrivateJainSipClientConnector.prototype.processResponse=function(d){try{var e=d.getResponse();if(e.getCSeq().getMethod()==="REGISTER"){this.processSipRegisterResponse(d)}else{var a=e.getCallId().getCallId();var b=this.sessionConnectors[a];if(b){b.onJainSipClientConnectorSipResponseEvent(d)}else{}}}catch(c){console.error("PrivateJainSipClientConnector:processResponse(): catched exception:"+c)}};PrivateJainSipClientConnector.prototype.processTransactionTerminated=function(){};PrivateJainSipClientConnector.prototype.processDialogTerminated=function(){};PrivateJainSipClientConnector.prototype.processIOException=function(a){console.error("PrivateJainSipClientConnector:processIOException(): exceptionEvent="+a.message)};PrivateJainSipClientConnector.prototype.processTimeout=function(b){try{var e=b.getClientTransaction();var c=e.getDialog().getCallId().getCallId();var a=this.sessionConnectors[c];if(a){a.onJainSipClientConnectorSipTimeoutEvent(b)}else{if(this.jainSipRegisterRequest.getCallId().getCallId()===c){console.error("PrivateJainSipClientConnector:processTimeout(): SIP registration failed, request timeout, no response from SIP server");this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent("Request Timeout")}else{}}}catch(d){console.error("PrivateJainSipClientConnector:processTimeout(): catched exception:"+d)}};PrivateJainSipClientConnector.prototype.onSipRegisterTimeout=function(){try{if(this.sipRegisterState===this.SIP_REGISTERED_STATE){this.sipRegisterRefreshTimer=undefined;this.sipRegisterState=this.SIP_REGISTER_REFRESHING_STATE;this.sendNewSipRegisterRequest(this.SIP_SESSION_EXPIRATION_TIMER)}else{}}catch(a){console.error("PrivateJainSipClientConnector:onSipRegisterTimeout(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.processSipRegisterResponse=function(d){var e=d.getResponse();var b=parseInt(e.getStatusCode());if(this.sipRegisterState===this.SIP_UNREGISTERED_STATE){console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}else{if((this.sipRegisterState===this.SIP_REGISTERING_STATE)||(this.sipRegisterState===this.SIP_REGISTER_REFRESHING_STATE)){if(b<200){}else{if(b===401||b===407){if(this.configuration.sipPassword!==undefined&&this.configuration.sipLogin!==undefined){this.sipRegisterState=this.SIP_REGISTERING_401_STATE;var a=this.jainSipHeaderFactory.createAuthorizationHeader(e,this.jainSipRegisterRequest,this.configuration.sipPassword,this.configuration.sipLogin);this.sendAuthenticatedSipRegisterRequest(a)}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP registration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent()}}else{if(b===200){this.sipRegisterState=this.SIP_REGISTERED_STATE;if(this.openedFlag===false){this.openedFlag=true;this.webRTCommClient.onPrivateClientConnectorOpenedEvent()}if(this.sipUnregisterPendingFlag===true){this.sipUnregisterPendingFlag=false;this.sipRegisterState=this.SIP_UNREGISTERING_STATE;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sendNewSipRegisterRequest(0)}else{var c=this;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sipRegisterRefreshTimer=setTimeout(function(){c.onSipRegisterTimeout()},40000)}}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP registration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent()}}}}else{if(this.sipRegisterState===this.SIP_REGISTERING_401_STATE){if(b<200){}else{if(b===200){this.sipRegisterState=this.SIP_REGISTERED_STATE;if(this.openedFlag===false){this.openedFlag=true;this.webRTCommClient.onPrivateClientConnectorOpenedEvent()}if(this.sipUnregisterPendingFlag===true){this.sipUnregisterPendingFlag=false;this.sipRegisterState=this.SIP_UNREGISTERING_STATE;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sendNewSipRegisterRequest(0)}else{var c=this;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sipRegisterRefreshTimer=setTimeout(function(){c.onSipRegisterTimeout()},40000)}}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP registration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRTCommClient.onPrivateClientConnectorOpenErrorEvent()}}}else{if(this.sipRegisterState===this.SIP_REGISTERED_STATE){console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}else{if(this.sipRegisterState===this.SIP_UNREGISTERING_STATE){if(b<200){}else{if(b===401||b===407){this.sipRegisterState=this.SIP_UNREGISTERING_401_STATE;a=this.jainSipHeaderFactory.createAuthorizationHeader(e,this.jainSipRegisterRequest,this.configuration.sipPassword,this.configuration.sipLogin);this.sendAuthenticatedSipRegisterRequest(a)}else{if(b===200){this.reset();this.webRTCommClient.onPrivateClientConnectorClosedEvent()}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP unregistration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRTCommClient.onPrivateClientConnectorClosedEvent()}}}}else{if(this.sipRegisterState===this.SIP_UNREGISTERING_401_STATE){if(b<200){}else{if(b===200){this.reset();this.webRTCommClient.onPrivateClientConnectorClosedEvent()}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP unregistration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRTCommClient.onPrivateClientConnectorClosedEvent()}}}else{if(this.sipRegisterState===this.SIP_UNREGISTERED_STATE){console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}}}}}}}};PrivateJainSipClientConnector.prototype.processSipOptionRequest=function(a){var b=a.getRequest();var c=b.createResponse(200,"OK");c.addHeader(this.jainSipContactHeader);c.removeHeader("P-Asserted-Identity");c.removeHeader("P-Charging-Vector");c.removeHeader("P-Charging-Function-Addresses");c.removeHeader("P-Called-Party-ID");a.getServerTransaction().sendResponse(c)};WebRTCommCall=function(a){if(a instanceof WebRTCommClient){this.id=undefined;this.webRTCommClient=a;this.calleePhoneNumber=undefined;this.callerPhoneNumber=undefined;this.callerDisplayName=undefined;this.incomingCallFlag=false;this.configuration=undefined;this.connector=undefined;this.peerConnection=undefined;this.peerConnectionState=undefined;this.remoteBundledAudioVideoMediaStream=undefined;this.remoteAudioMediaStream=undefined;this.remoteVideoMediaStream=undefined;this.remoteSdpOffer=undefined;this.messageChannel=undefined;this.dtmfSender=undefined;this.eventListener=a.eventListener}else{throw"WebRTCommCall:WebRTCommCall(): bad arguments"}};WebRTCommCall.prototype.codecNames={0:"PCMU",8:"PCMA"};WebRTCommCall.prototype.isOpened=function(){if(this.connector){return this.connector.isOpened()}else{return false}};WebRTCommCall.prototype.isIncoming=function(){if(this.isOpened()){return this.incomingCallFlag}else{console.error("WebRTCommCall:isIncoming(): bad state, unauthorized action");throw"WebRTCommCall:isIncoming(): bad state, unauthorized action"}};WebRTCommCall.prototype.getId=function(){return this.id};WebRTCommCall.prototype.getCallerPhoneNumber=function(){return this.callerPhoneNumber};WebRTCommCall.prototype.getCallerDisplayName=function(){return this.callerDisplayName};WebRTCommCall.prototype.getConfiguration=function(){return this.configuration};WebRTCommCall.prototype.getCalleePhoneNumber=function(){return this.calleePhoneNumber};WebRTCommCall.prototype.getRemoteBundledAudioVideoMediaStream=function(){return this.remoteBundledAudioVideoMediaStream};WebRTCommCall.prototype.getRemoteAudioMediaStream=function(){return this.remoteAudioMediaStream};WebRTCommCall.prototype.getRemoteVideoMediaStream=function(){return this.remoteVideoMediaStream};WebRTCommCall.prototype.setEventListener=function(a){this.eventListener=a};WebRTCommCall.prototype.open=function(d,g){if(typeof(g)==="object"){if(this.webRTCommClient.isOpened()){if(this.checkConfiguration(g)){if(this.isOpened()===false){try{var c=this;this.callerPhoneNumber=this.webRTCommClient.configuration.sip.sipUserName;this.calleePhoneNumber=d;this.configuration=g;this.connector.open(g);this.createRTCPeerConnection();if(g.audioMediaFlag||g.videoMediaFlag){this.peerConnection.addStream(this.configuration.localMediaStream)}if(this.configuration.messageMediaFlag){if(this.peerConnection.createDataChannel){try{this.messageChannel=this.peerConnection.createDataChannel("mymessageChannel",{reliable:false});this.messageChannel.onopen=function(e){c.onRtcPeerConnectionMessageChannelOnOpenEvent(e)};this.messageChannel.onclose=function(e){c.onRtcPeerConnectionMessageChannelOnClose(e)};this.messageChannel.onerror=function(e){c.onRtcPeerConnectionMessageChannelOnErrorEvent(e)};this.messageChannel.onmessage=function(e){c.onRtcPeerConnectionMessageChannelOnMessageEvent(e)}}catch(a){alert("WebRTCommCall:open():DataChannel not supported")}}}if(window.webkitRTCPeerConnection){var b={mandatory:{OfferToReceiveAudio:this.configuration.audioMediaFlag,OfferToReceiveVideo:this.configuration.videoMediaFlag},optional:[]};this.peerConnection.createOffer(function(e){c.onRtcPeerConnectionCreateOfferSuccessEvent(e)},function(e){c.onRtcPeerConnectionCreateOfferErrorEvent(e)},b)}else{if(window.mozRTCPeerConnection){var b={offerToReceiveAudio:this.configuration.audioMediaFlag,offerToReceiveVideo:this.configuration.videoMediaFlag,mozDontOfferDataChannel:!this.configuration.messageMediaFlag};this.peerConnection.createOffer(function(e){c.onRtcPeerConnectionCreateOfferSuccessEvent(e)},function(e){c.onRtcPeerConnectionCreateOfferErrorEvent(e)},b)}}}catch(a){console.error("WebRTCommCall:open(): catched exception:"+a);setTimeout(function(){try{c.eventListener.onWebRTCommCallOpenErrorEvent(c,e)}catch(e){console.error("WebRTCommCall:open(): catched exception in listener:"+e)}},1);try{this.close()}catch(f){}throw a}}else{console.error("WebRTCommCall:open(): bad state, unauthorized action");throw"WebRTCommCall:open(): bad state, unauthorized action"}}else{console.error("WebRTCommCall:open(): bad configuration");throw"WebRTCommCall:open(): bad configuration"}}else{console.error("WebRTCommCall:open(): bad state, unauthorized action");throw"WebRTCommCall:open(): bad state, unauthorized action"}}else{console.error("WebRTCommCall:open(): bad argument, check API documentation");throw"WebRTCommCall:open(): bad argument, check API documentation"}};WebRTCommCall.prototype.close=function(){if(this.webRTCommClient.isOpened()){try{if(this.connector){this.connector.close()}if(this.peerConnection&&this.peerConnection.signalingState!=="closed"){if(this.messageChannel){this.messageChannel.close()}this.peerConnection.close();this.peerConnection=undefined;this.dtmfSender=undefined;var b=this;setTimeout(function(){b.eventListener.onWebRTCommCallClosedEvent(b)},1)}}catch(a){console.error("WebRTCommCall:close(): catched exception:"+a)}}else{console.error("WebRTCommCall:close(): bad state, unauthorized action");throw"WebRTCommCall:close(): bad state, unauthorized action"}};WebRTCommCall.prototype.accept=function(f){if(typeof(f)==="object"){if(this.webRTCommClient.isOpened()){if(this.checkConfiguration(f)){this.configuration=f;if(this.isOpened()===false){try{this.createRTCPeerConnection();if(f.audioMediaFlag||f.videoMediaFlag){this.peerConnection.addStream(this.configuration.localMediaStream)}var d=undefined;if(window.webkitRTCPeerConnection){d=new RTCSessionDescription({type:"offer",sdp:this.remoteSdpOffer})}else{if(window.mozRTCPeerConnection){d=new mozRTCSessionDescription({type:"offer",sdp:this.remoteSdpOffer})}}var b=this;this.peerConnectionState="offer-received";this.peerConnection.setRemoteDescription(d,function(){b.onRtcPeerConnectionSetRemoteDescriptionSuccessEvent()},function(e){b.onRtcPeerConnectionSetRemoteDescriptionErrorEvent(e)})}catch(a){console.error("WebRTCommCall:accept(): catched exception:"+a);try{this.close()}catch(c){}throw a}}else{console.error("WebRTCommCall:accept(): bad state, unauthorized action");throw"WebRTCommCall:accept(): bad state, unauthorized action"}}else{console.error("WebRTCommCall:accept(): bad configuration");throw"WebRTCommCall:accept(): bad configuration"}}else{console.error("WebRTCommCall:accept(): bad state, unauthorized action");throw"WebRTCommCall:accept(): bad state, unauthorized action"}}else{console.error("WebRTCommCall:accept(): bad argument, check API documentation");throw"WebRTCommCall:accept(): bad argument, check API documentation"}};WebRTCommCall.prototype.reject=function(){if(this.webRTCommClient.isOpened()){try{this.connector.reject();var b=this;setTimeout(function(){b.eventListener.onWebRTCommCallClosedEvent(b)},1)}catch(a){console.error("WebRTCommCall:reject(): catched exception:"+a);try{this.close()}catch(c){}throw a}}else{console.error("WebRTCommCall:reject(): bad state, unauthorized action");throw"WebRTCommCall:reject(): bad state, unauthorized action"}};WebRTCommCall.prototype.ignore=function(){if(this.webRTCommClient.isOpened()){try{this.connector.ignore();var b=this;setTimeout(function(){b.eventListener.onWebRTCommCallClosedEvent(b)},1)}catch(a){console.error("WebRTCommCall:ignore(): catched exception:"+a);try{this.close()}catch(c){}throw a}}else{console.error("WebRTCommCall:ignore(): bad state, unauthorized action");throw"WebRTCommCall:ignore(): bad state, unauthorized action"}};WebRTCommCall.prototype.sendDTMF=function(b){var a=500;var c=50;if(this.dtmfSender){this.dtmfSender.insertDTMF(b,a,c)}else{}};WebRTCommCall.prototype.sendMessage=function(c){if(this.webRTCommClient.isOpened()){if(this.isOpened()){var a=new WebRTCommMessage(this.webRTCommClient,this);a.text=c;if(this.isIncoming()){a.to=this.callerPhoneNumber}else{a.to=this.calleePhoneNumber}try{a.connector.send()}catch(b){console.error("WebRTCommCall:sendMessage(): catched exception:"+b);throw"WebRTCommCall:sendMessage(): catched exception:"+b}return a}else{console.error("WebRTCommCall:sendMessage(): bad state, unauthorized action");throw"WebRTCommCall:sendMessage(): bad state, unauthorized action"}}else{console.error("WebRTCommCall:sendMessage(): bad state, unauthorized action");throw"WebRTCommCall:sendMessage(): bad state, unauthorized action"}};WebRTCommCall.prototype.sendDataMessage=function(c){if(this.webRTCommClient.isOpened()){if(this.isOpened()){var d=new WebRTCommDataMessage(this.webRTCommClient,this);d.content=c;if(this.isIncoming()){d.to=this.callerPhoneNumber}else{d.to=this.calleePhoneNumber}if(this.messageChannel&&this.messageChannel.readyState==="open"){try{this.messageChannel.send(d.content);if(this.eventListener.onWebRTCommDataMessageSentEvent){var b=this;setTimeout(function(){try{b.eventListener.onWebRTCommDataMessageSentEvent(d)}catch(e){console.error("WebRTCommCall:sendDataMessage(): catched exception in event listener:"+e)}},1)}}catch(a){console.error("WebRTCommCall:sendDataMessage(): catched exception:"+a);throw"WebRTCommCall:sendDataMessage(): catched exception:"+a}}return d}else{console.error("WebRTCommCall:sendDataMessage(): bad state, unauthorized action");throw"WebRTCommCall:sendDataMessage(): bad state, unauthorized action"}}else{console.error("WebRTCommCall:sendDataMessage(): bad state, unauthorized action");throw"WebRTCommCall:sendDataMessage(): bad state, unauthorized action"}};WebRTCommCall.prototype.muteLocalAudioMediaStream=function(){if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState===this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.audioTracks){b=this.configuration.localMediaStream.audioTracks}else{if(this.configuration.localMediaStream.getAudioTracks){b=this.configuration.localMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRTCommCall:muteLocalAudioMediaStream(): not implemented by navigator");throw"WebRTCommCall:muteLocalAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:muteLocalAudioMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:muteLocalAudioMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.unmuteLocalAudioMediaStream=function(){if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState===this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.audioTracks){b=this.configuration.localMediaStream.audioTracks}else{if(this.configuration.localMediaStream.getAudioTracks){b=this.configuration.localMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRTCommCall:unmuteLocalAudioMediaStream(): not implemented by navigator");throw"WebRTCommCall:unmuteLocalAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:unmuteLocalAudioMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:unmuteLocalAudioMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.muteRemoteAudioMediaStream=function(){if(this.remoteBundledAudioVideoMediaStream&&this.remoteBundledAudioVideoMediaStream.signalingState===this.remoteBundledAudioVideoMediaStream.LIVE){var b=undefined;if(this.remoteBundledAudioVideoMediaStream.audioTracks){b=this.remoteBundledAudioVideoMediaStream.audioTracks}else{if(this.remoteBundledAudioVideoMediaStream.getAudioTracks){b=this.remoteBundledAudioVideoMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRTCommCall:muteRemoteAudioMediaStream(): not implemented by navigator");throw"WebRTCommCall:muteRemoteAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:muteRemoteAudioMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:muteRemoteAudioMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.unmuteRemoteAudioMediaStream=function(){if(this.remoteBundledAudioVideoMediaStream&&this.remoteBundledAudioVideoMediaStream.signalingState===this.remoteBundledAudioVideoMediaStream.LIVE){var b=undefined;if(this.remoteBundledAudioVideoMediaStream.audioTracks){b=this.remoteBundledAudioVideoMediaStream.audioTracks}else{if(this.remoteBundledAudioVideoMediaStream.getAudioTracks){b=this.remoteBundledAudioVideoMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRTCommCall:unmuteRemoteAudioMediaStream(): not implemented by navigator");throw"WebRTCommCall:unmuteRemoteAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:unmuteRemoteAudioMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:unmuteRemoteAudioMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.hideLocalVideoMediaStream=function(){if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState===this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.videoTracks){b=this.configuration.localMediaStream.videoTracks}else{if(this.configuration.localMediaStream.getVideoTracks){b=this.configuration.localMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRTCommCall:hideLocalVideoMediaStream(): not implemented by navigator");throw"WebRTCommCall:hideLocalVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:hideLocalVideoMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:hideLocalVideoMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.showLocalVideoMediaStream=function(){if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState===this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.videoTracks){b=this.configuration.localMediaStream.videoTracks}else{if(this.configuration.localMediaStream.getVideoTracks){b=this.configuration.localMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRTCommCall:showLocalVideoMediaStream(): not implemented by navigator");throw"WebRTCommCall:showLocalVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:showLocalVideoMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:showLocalVideoMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.hideRemoteVideoMediaStream=function(){if(this.remoteBundledAudioVideoMediaStream&&this.remoteBundledAudioVideoMediaStream.signalingState===this.remoteBundledAudioVideoMediaStream.LIVE){var b=undefined;if(this.remoteBundledAudioVideoMediaStream.videoTracks){b=this.remoteBundledAudioVideoMediaStream.videoTracks}else{if(this.remoteBundledAudioVideoMediaStream.getVideoTracks){b=this.remoteBundledAudioVideoMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRTCommCall:hideRemoteVideoMediaStream(): not implemented by navigator");throw"WebRTCommCall:hideRemoteVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:hideRemoteVideoMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:hideRemoteVideoMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.showRemoteVideoMediaStream=function(){if(this.remoteBundledAudioVideoMediaStream&&this.remoteBundledAudioVideoMediaStream.signalingState===this.remoteBundledAudioVideoMediaStream.LIVE){var b=undefined;if(this.remoteBundledAudioVideoMediaStream.videoTracks){b=this.remoteBundledAudioVideoMediaStream.videoTracks}else{if(this.remoteBundledAudioVideoMediaStream.getVideoTracks){b=this.remoteBundledAudioVideoMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRTCommCall:showRemoteVideoMediaStream(): not implemented by navigator");throw"WebRTCommCall:showRemoteVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRTCommCall:showRemoteVideoMediaStream(): bad state, unauthorized action");throw"WebRTCommCall:showRemoteVideoMediaStream(): bad state, unauthorized action"}};WebRTCommCall.prototype.checkConfiguration=function(b){var a=true;if(b.audioMediaFlag===undefined||(typeof(b.audioMediaFlag)!=="boolean")){a=false;console.error("WebRTCommCall:checkConfiguration(): missing audio media flag")}if(b.videoMediaFlag===undefined||(typeof(b.videoMediaFlag)!=="boolean")){a=false;console.error("WebRTCommCall:checkConfiguration(): missing video media flag")}if((b.audioMediaFlag||b.videoMediaFlag)&&b.localMediaStream===undefined){a=false;console.error("WebRTCommCall:checkConfiguration(): missing localMediaStream")}if(b.messageMediaFlag===undefined||(typeof(b.messageMediaFlag)!=="boolean")){a=false;console.error("WebRTCommCall:checkConfiguration(): missing message media flag")}return a};WebRTCommCall.prototype.createRTCPeerConnection=function(){var a={iceServers:[]};this.peerConnectionState="new";var b=this;if(this.webRTCommClient.configuration.RTCPeerConnection.iceServers){a=this.webRTCommClient.configuration.RTCPeerConnection.iceServers}else{if(this.webRTCommClient.configuration.RTCPeerConnection.stunServer){a.iceServers.push({url:"stun:"+this.webRTCommClient.configuration.RTCPeerConnection.stunServer})}if(this.webRTCommClient.configuration.RTCPeerConnection.turnServer&&this.webRTCommClient.configuration.RTCPeerConnection.turnLogin&&this.webRTCommClient.configuration.RTCPeerConnection.turnPassword){a.iceServers.push({url:"turn:"+this.webRTCommClient.configuration.RTCPeerConnection.turnServer,username:this.webRTCommClient.configuration.RTCPeerConnection.turnLogin,credential:this.webRTCommClient.configuration.RTCPeerConnection.turnPassword})}}if(window.webkitRTCPeerConnection){var c="all";if(this.webRTCommClient.configuration.RTCPeerConnection.forceTurnMediaRelay){c="relay"}var d={mandatory:{IceTransports:c},optional:[]};this.peerConnection=new window.webkitRTCPeerConnection(a,d)}else{if(window.mozRTCPeerConnection){this.peerConnection=new window.mozRTCPeerConnection(a,d)}}this.peerConnection.onaddstream=function(e){b.onRtcPeerConnectionOnAddStreamEvent(e)};this.peerConnection.onremovestream=function(e){b.onRtcPeerConnectionOnRemoveStreamEvent(e)};this.peerConnection.onstatechange=function(e){b.onRtcPeerConnectionStateChangeEvent(e)};if(window.webkitRTCPeerConnection){this.peerConnection.onsignalingstatechange=function(e){b.onRtcPeerConnectionStateChangeEvent(e)}}this.peerConnection.onicecandidate=function(e){b.onRtcPeerConnectionIceCandidateEvent(e)};this.peerConnection.ongatheringchange=function(e){b.onRtcPeerConnectionGatheringChangeEvent(e)};this.peerConnection.onicechange=function(e){b.onRtcPeerConnectionIceChangeEvent(e)};if(window.webkitRTCPeerConnection){this.peerConnection.oniceconnectionstatechange=function(e){b.onRtcPeerConnectionIceChangeEvent(e)}}this.peerConnection.onopen=function(e){b.onRtcPeerConnectionOnOpenEvent(e)};if(window.webkitRTCPeerConnection){this.peerConnection.onidentityresult=function(e){b.onRtcPeerConnectionIdentityResultEvent(e)}}this.peerConnection.ondatachannel=function(e){b.onRtcPeerConnectionOnMessageChannelEvent(e)}};WebRTCommCall.prototype.onPrivateCallConnectorRemoteSdpOfferEvent=function(a){this.remoteSdpOffer=a};WebRTCommCall.prototype.onPrivateCallConnectorRemoteSdpAnswerEvent=function(d){try{var c=undefined;if(window.webkitRTCPeerConnection){c=new RTCSessionDescription({type:"answer",sdp:d})}else{if(window.mozRTCPeerConnection){c=new mozRTCSessionDescription({type:"answer",sdp:d})}}var b=this;this.peerConnectionState="answer-received";this.peerConnection.setRemoteDescription(c,function(){b.onRtcPeerConnectionSetRemoteDescriptionSuccessEvent()},function(e){b.onRtcPeerConnectionSetRemoteDescriptionErrorEvent(e)})}catch(a){console.error("WebRTCommCall:onPrivateCallConnectorRemoteSdpAnswerEvent(): catched exception:"+a);throw a}};WebRTCommCall.prototype.onPrivateCallConnectorCallOpenedEvent=function(){if(this.eventListener.onWebRTCommCallOpenEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommCallOpenEvent(a)}catch(b){console.error("WebRTCommCall:onPrivateCallConnectorCallOpenedEvent(): catched exception in listener:"+b)}},1)}};WebRTCommCall.prototype.onPrivateCallConnectorCallInProgressEvent=function(){if(this.eventListener.onWebRTCommCallInProgressEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommCallInProgressEvent(a)}catch(b){console.error("WebRTCommCall:onPrivateCallConnectorCallInProgressEvent(): catched exception in listener:"+b)}},1)}};WebRTCommCall.prototype.onPrivateCallConnectorCallOpenErrorEvent=function(a){if(this.eventListener.onWebRTCommCallOpenErrorEvent){var b=this;setTimeout(function(){try{b.eventListener.onWebRTCommCallOpenErrorEvent(b,a)}catch(c){console.error("WebRTCommCall:onPrivateCallConnectorCallOpenErrorEvent(): catched exception in listener:"+c)}},1)}};WebRTCommCall.prototype.onPrivateCallConnectorCallRingingEvent=function(b,a){this.callerPhoneNumber=b;this.callerDisplayName=a;if(this.eventListener.onWebRTCommCallRingingEvent){var c=this;setTimeout(function(){try{c.eventListener.onWebRTCommCallRingingEvent(c)}catch(d){console.error("WebRTCommCall:onPrivateCallConnectorCallRingingEvent(): catched exception in listener:"+d)}},1)}};WebRTCommCall.prototype.onPrivateCallConnectorCallRingingBackEvent=function(){if(this.eventListener.onWebRTCommCallRingingBackEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommCallRingingBackEvent(a)}catch(b){console.error("WebRTCommCall:onPrivateCallConnectorCallRingingBackEvent(): catched exception in listener:"+b)}},1)}};WebRTCommCall.prototype.onPrivateCallConnectorCallClosedEvent=function(){this.connector=undefined;try{this.close()}catch(a){}};WebRTCommCall.prototype.onPrivateCallConnectorCallHangupEvent=function(){if(this.eventListener.onWebRTCommCallHangupEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommCallHangupEvent(a)}catch(b){console.error("WebRTCommCall:onPrivateCallConnectorCallHangupEvent(): catched exception in listener:"+b)}},1)}};WebRTCommCall.prototype.onPrivateCallConnectorCallCanceledEvent=function(){if(this.eventListener.onWebRTCommCallCanceledEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommCallCanceledEvent(a)}catch(b){console.error("WebRTCommCall:onPrivateCallConnectorCallCanceledEvent(): catched exception in listener:"+b)}},1)}};WebRTCommCall.prototype.onRtcPeerConnectionErrorEvent=function(a){if(this.eventListener.onWebRTCommCallOpenErrorEvent){var c=this;setTimeout(function(){try{c.eventListener.onWebRTCommCallOpenErrorEvent(c,a)}catch(d){console.error("WebRTCommCall:onRtcPeerConnectionErrorEvent(): catched exception in listener:"+d)}},1)}try{this.close()}catch(b){}};WebRTCommCall.prototype.onRtcPeerConnectionOnAddStreamEvent=function(c){try{if(this.peerConnection){this.remoteBundledAudioVideoMediaStream=c.stream;if(this.eventListener.onWebRTCommCallOpenedEvent){var b=this;setTimeout(function(){try{b.eventListener.onWebRTCommCallOpenedEvent(b);if(b.peerConnection.createDTMFSender){if(b.configuration.localMediaStream!==null){var e=b.configuration.localMediaStream.getAudioTracks()[0];b.dtmfSender=b.peerConnection.createDTMFSender(e)}else{}}else{}}catch(d){console.error("WebRTCommCall:onRtcPeerConnectionOnAddStreamEvent(): catched exception in listener:"+d)}},1)}}else{}}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionOnAddStreamEvent(): catched exception, exception:"+a);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionOnRemoveStreamEvent=function(b){try{if(this.peerConnection){this.remoteBundledAudioVideoMediaStream=undefined}else{}}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionOnRemoveStreamEvent(): catched exception, exception:"+a);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionIceCandidateEvent=function(g){try{if(this.peerConnection){if(this.peerConnection.signalingState!=="closed"){if(this.peerConnection.iceGatheringState==="complete"){if(this.peerConnectionState==="preparing-offer"){var b=this.peerConnection.localDescription.sdp;var a=this.setRtcPeerConnectionLocalDescription(this.peerConnection.localDescription);this.connector.invite(a);this.peerConnectionState="offer-sent"}else{if(this.peerConnectionState==="preparing-answer"){var d=this.peerConnection.localDescription.sdp;var f=this.setRtcPeerConnectionLocalDescription(this.peerConnection.localDescription);this.connector.accept(f);this.peerConnectionState="established";if(this.eventListener.onWebRTCommCallOpenedEvent){var e=this;setTimeout(function(){try{e.eventListener.onWebRTCommCallOpenedEvent(e)}catch(h){console.error("WebRTCommCall:onRtcPeerConnectionIceCandidateEvent(): catched exception in listener:"+h)}},1)}}else{if(this.peerConnectionState==="established"){}else{console.error("WebRTCommCall:onRtcPeerConnectionIceCandidateEvent(): RTCPeerConnection bad state!"+this.peerConnectionState)}}}}}else{console.error("WebRTCommCall:onRtcPeerConnectionIceCandidateEvent(): RTCPeerConnection closed!")}}else{}}catch(c){console.error("WebRTCommCall:onRtcPeerConnectionIceCandidateEvent(): catched exception, exception:"+c);this.onRtcPeerConnectionErrorEvent(c)}};WebRTCommCall.prototype.onRtcPeerConnectionCreateOfferSuccessEvent=function(c){try{if(this.peerConnection){if(this.peerConnectionState==="new"){var b=this;this.peerConnectionState="preparing-offer";if(window.webkitRTCPeerConnection){this.setRtcPeerConnectionLocalDescription(c)}this.peerConnection.setLocalDescription(c,function(){b.onRtcPeerConnectionSetLocalDescriptionSuccessEvent()},function(d){b.onRtcPeerConnectionSetLocalDescriptionErrorEvent(d)})}else{console.error("WebRTCommCall:onRtcPeerConnectionCreateOfferSuccessEvent(): RTCPeerConnection bad state!")}}else{}}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionCreateOfferSuccessEvent(): catched exception, exception:"+a);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.setRtcPeerConnectionLocalDescription=function(e){var b=e.sdp;var d=new SDPParser();var a=d.parse(b);if(window.webkitRTCPeerConnection){if(this.configuration.videoMediaFlag===false){this.removeMediaDescription(a,"video")}if(this.configuration.audioMediaFlag===false){this.removeMediaDescription(a,"audio")}}if(this.configuration.audioCodecsFilter||this.configuration.videoCodecsFilter||this.configuration.opusFmtpCodecsParameters){try{this.applyConfiguredCodecFilterOnSessionDescription(a)}catch(c){console.error("WebRTCommCall:onRtcPeerConnectionCreateOfferSuccessEvent(): configured codec filtering has failded, use inital RTCPeerConnection SDP offer")}}if(this.webRTCommClient.configuration.RTCPeerConnection.forceTurnMediaRelay===true){this.forceTurnMediaRelay(a)}e.sdp=a;this.peerConnectionLocalDescription=e;return a};WebRTCommCall.prototype.onRtcPeerConnectionCreateOfferErrorEvent=function(a){try{console.error("WebRTCommCall:onRtcPeerConnectionCreateOfferErrorEvent():error="+JSON.stringify(a));if(this.peerConnection){throw"WebRTCommCall:onRtcPeerConnectionCreateOfferErrorEvent():error="+a}else{}}catch(b){console.error("WebRTCommCall:onRtcPeerConnectionCreateOfferErrorEvent(): catched exception, exception:"+b);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionSetLocalDescriptionSuccessEvent=function(){try{if(this.peerConnection){}else{}}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionSetLocalDescriptionSuccessEvent(): catched exception, exception:"+a);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionSetLocalDescriptionErrorEvent=function(a){try{console.error("WebRTCommCall:onRtcPeerConnectionSetLocalDescriptionErrorEvent():error="+JSON.stringify(a));if(this.peerConnection){throw"WebRTCommCall:onRtcPeerConnectionSetLocalDescriptionErrorEvent():error="+a}else{}}catch(b){console.error("WebRTCommCall:onRtcPeerConnectionSetLocalDescriptionErrorEvent(): catched exception, exception:"+b);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionCreateAnswerSuccessEvent=function(e){try{if(this.peerConnection){if(this.peerConnectionState==="offer-received"){var d=this;this.peerConnectionState="preparing-answer";var b=e.sdp;var f=new SDPParser();var c=f.parse(b);if(this.configuration.audioCodecsFilter||this.configuration.videoCodecsFilter||this.configuration.opusFmtpCodecsParameters){try{this.applyConfiguredCodecFilterOnSessionDescription(c)}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionCreateAnswerSuccessEvent(): configured codec filtering has failded, use inital RTCPeerConnection SDP offer")}}e.sdp=c;this.peerConnectionLocalDescription=c;this.peerConnection.setLocalDescription(e,function(){d.onRtcPeerConnectionSetLocalDescriptionSuccessEvent()},function(g){d.onRtcPeerConnectionSetLocalDescriptionErrorEvent(g)})}else{console.error("WebRTCommCall:onRtcPeerConnectionCreateAnswerSuccessEvent(): RTCPeerConnection bad state!")}}else{}}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionCreateAnswerSuccessEvent(): catched exception, exception:"+a);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionCreateAnswerErrorEvent=function(a){console.error("WebRTCommCall:onRtcPeerConnectionCreateAnswerErrorEvent():error="+JSON.stringify(a));try{if(this.peerConnection){}else{}}catch(b){console.error("WebRTCommCall:onRtcPeerConnectionCreateAnswerErrorEvent(): catched exception, exception:"+b);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionSetRemoteDescriptionSuccessEvent=function(){try{if(this.peerConnection){if(this.peerConnectionState==="answer-received"){this.peerConnectionState="established";if(this.eventListener.onWebRTCommCallOpenedEvent){var c=this;setTimeout(function(){try{c.eventListener.onWebRTCommCallOpenedEvent(c)}catch(d){console.error("WebRTCommCall:onRtcPeerConnectionSetRemoteDescriptionSuccessEvent(): catched exception in listener:"+d)}},1)}}else{if(this.peerConnectionState==="offer-received"){var c=this;if(window.webkitRTCPeerConnection){var b={mandatory:{OfferToReceiveAudio:this.configuration.audioMediaFlag,OfferToReceiveVideo:this.configuration.videoMediaFlag},optional:[]};this.peerConnection.createAnswer(function(d){c.onRtcPeerConnectionCreateAnswerSuccessEvent(d)},function(d){c.onRtcPeerConnectionCreateAnswerErrorEvent(d)},b)}else{if(window.mozRTCPeerConnection){var b={offerToReceiveAudio:this.configuration.audioMediaFlag,offerToReceiveVideo:this.configuration.videoMediaFlag,mozDontOfferDataChannel:!this.configuration.messageMediaFlag};this.peerConnection.createAnswer(function(d){c.onRtcPeerConnectionCreateAnswerSuccessEvent(d)},function(d){c.onRtcPeerConnectionCreateAnswerErrorEvent(d)},b)}}}else{console.error("WebRTCommCall:onRtcPeerConnectionSetRemoteDescriptionSuccessEvent(): RTCPeerConnection bad state!")}}}else{}}catch(a){console.error("WebRTCommCall:onRtcPeerConnectionSetRemoteDescriptionSuccessEvent(): catched exception, exception:"+a);this.onRtcPeerConnectionErrorEvent()}};WebRTCommCall.prototype.onRtcPeerConnectionSetRemoteDescriptionErrorEvent=function(a){try{console.error("WebRTCommCall:onRtcPeerConnectionSetRemoteDescriptionErrorEvent():error="+JSON.stringify(a));if(this.peerConnection){throw"WebRTCommCall:onRtcPeerConnectionSetRemoteDescriptionErrorEvent():error="+a}else{}}catch(b){this.onRtcPeerConnectionErrorEvent(a)}};WebRTCommCall.prototype.onRtcPeerConnectionOnOpenEvent=function(a){if(this.peerConnection){}else{}};WebRTCommCall.prototype.onRtcPeerConnectionStateChangeEvent=function(a){if(this.peerConnection){if(this.peerConnection&&this.peerConnection.signalingState==="closed"){this.peerConnection=null}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionIceNegotiationNeededEvent=function(a){if(this.peerConnection){}else{}};WebRTCommCall.prototype.onRtcPeerConnectionGatheringChangeEvent=function(f){if(this.peerConnection){if(this.peerConnection.signalingState!=="closed"){if(this.peerConnection.iceGatheringState==="complete"){if(this.peerConnectionState==="preparing-offer"){var b=this.peerConnection.localDescription.sdp;var a=this.setRtcPeerConnectionLocalDescription(this.peerConnection.localDescription);this.connector.invite(a);this.peerConnectionState="offer-sent"}else{if(this.peerConnectionState==="preparing-answer"){var c=this.peerConnection.localDescription.sdp;var e=this.setRtcPeerConnectionLocalDescription(this.peerConnection.localDescription);this.connector.accept(e);this.peerConnectionState="established";if(this.eventListener.onWebRTCommCallOpenedEvent){var d=this;setTimeout(function(){try{d.eventListener.onWebRTCommCallOpenedEvent(d)}catch(g){console.error("WebRTCommCall:onRtcPeerConnectionGatheringChangeEvent(): catched exception in listener:"+g)}},1)}}else{if(this.peerConnectionState==="established"){}else{console.error("WebRTCommCall:onRtcPeerConnectionGatheringChangeEvent(): RTCPeerConnection bad state!")}}}}}else{console.error("WebRTCommCall:onRtcPeerConnectionGatheringChangeEvent(): RTCPeerConnection closed!")}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionIceChangeEvent=function(a){if(this.peerConnection){if(this.peerConnection.iceConnectionState=="disconnected"){console.error("WebRTCommCall:onRtcPeerConnectionIceChangeEvent(): IceConnection disconnected (i.e. no media path); hunging up the call");this.close()}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionIdentityResultEvent=function(a){if(this.peerConnection){}else{}};WebRTCommCall.prototype.onRtcPeerConnectionOnMessageChannelEvent=function(b){if(this.peerConnection){this.messageChannel=b.channel;var a=this;this.messageChannel.onopen=function(c){a.onRtcPeerConnectionMessageChannelOnOpenEvent(c)};this.messageChannel.onclose=function(c){a.onRtcPeerConnectionMessageChannelOnClose(c)};this.messageChannel.onerror=function(c){a.onRtcPeerConnectionMessageChannelOnErrorEvent(c)};this.messageChannel.onmessage=function(c){a.onRtcPeerConnectionMessageChannelOnMessageEvent(c)}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionMessageChannelOnOpenEvent=function(b){if(this.peerConnection){if(this.messageChannel){if(this.eventListener.onWebRTCommDataMessageChannelOnOpenEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommDataMessageChannelOnOpenEvent()}catch(c){console.error("WebRTCommCall:onWebRTCommDataMessageChannelOnOpenEvent(): catched exception in event listener:"+c)}},1)}}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionMessageChannelOnClose=function(b){if(this.peerConnection){if(this.messageChannel){if(this.eventListener.onWebRTCommDataMessageChannelOnCloseEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommDataMessageChannelOnCloseEvent()}catch(c){console.error("WebRTCommCall:onWebRTCommDataMessageChannelOnCloseEvent(): catched exception in event listener:"+c)}},1)}}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionMessageChannelOnErrorEvent=function(b){if(this.peerConnection){if(this.messageChannel){if(this.eventListener.onWebRTCommDataMessageChannelOnErrorEvent){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommDataMessageChannelOnErrorEvent()}catch(c){console.error("WebRTCommCall:onWebRTCommDataMessageChannelOnErrorEvent(): catched exception in event listener:"+c)}},1)}}}else{}};WebRTCommCall.prototype.onRtcPeerConnectionMessageChannelOnMessageEvent=function(b){if(this.peerConnection){if(this.messageChannel){if(this.eventListener.onWebRTCommDataMessageReceivedEvent){var c=new WebRTCommDataMessage(this.webRTCommClient,this);c.content=b.data;var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommDataMessageReceivedEvent(c)}catch(d){console.error("WebRTCommCall:onRtcPeerConnectionMessageChannelOnMessageEvent(): catched exception in listener:"+d)}},1)}}}else{}};WebRTCommCall.prototype.applyConfiguredCodecFilterOnSessionDescription=function(f){if(f instanceof SessionDescription){try{var g=f.getMediaDescriptions(false);for(var e=0;e<g.length;e++){var a=g[e];var h=a.getMedia();var l=h.getType();if(l==="audio"){if(this.configuration.audioCodecsFilter){var k=this.getOfferedCodecsInMediaDescription(a);var j=(this.configuration.audioCodecsFilter).split(",");this.applyCodecFiltersOnOfferedCodecs(k,j);this.updateMediaDescription(a,k,j)}if(this.configuration.opusFmtpCodecsParameters){this.updateOpusMediaDescription(a,this.configuration.opusFmtpCodecsParameters)}}else{if(l==="video"&&this.configuration.videoCodecsFilter){var b=this.getOfferedCodecsInMediaDescription(a);var d=(this.configuration.videoCodecsFilter).split(",");this.applyCodecFiltersOnOfferedCodecs(b,d);this.updateMediaDescription(a,b,d)}}}}catch(c){console.error("WebRTCommCall:applyConfiguredCodecFilterOnSessionDescription(): catched exception, exception:"+c);throw c}}else{throw"WebRTCommCall:applyConfiguredCodecFilterOnSessionDescription(): bad arguments"}};WebRTCommCall.prototype.getOfferedCodecsInMediaDescription=function(a){if(a instanceof MediaDescription){var i=a.getMedia().getFormats(false);var f={};for(var h=0;h<i.length;h++){var o=i[h];f[o]=this.codecNames[o]}var e=a.getAttributes();for(var g=0;g<e.length;g++){var l=e[g];if(l.getName()==="rtpmap"){try{var d=l.getValue();var n=d.split(" ");var o=n[0];var b=n[1];var m=b.split("/");var p=m[0];f[o]=p.toUpperCase()}catch(c){console.error("WebRTCommCall:getOfferedCodecsInMediaDescription(): rtpmap/fmtp format not supported")}}}return f}else{throw"WebRTCommCall:getOfferedCodecsInMediaDescription(): bad arguments"}};WebRTCommCall.prototype.applyCodecFiltersOnOfferedCodecs=function(e,d){if(typeof(e)==="object"&&d instanceof Array){for(var b in e){var a=false;for(var c=0;c<d.length;c++){if(e[b]===d[c]){a=true;break}}if(a===false){delete (e[b])}}}else{throw"WebRTCommCall:applyCodecFiltersOnOfferedCodecs(): bad arguments"}};WebRTCommCall.prototype.updateMediaDescription=function(a,n,h){if(a instanceof MediaDescription&&typeof(n)==="object"&&h instanceof Array){var f=new Array();for(var l=0;l<h.length;l++){for(var j in n){if(n[j]===h[l]){f.push(j);break}}}a.getMedia().setFormats(f);var b=new Array();var e=a.getAttributes();for(var g=0;g<e.length;g++){var m=e[g];if(m.getName()==="rtpmap"||m.getName()==="fmtp"){try{var d=m.getValue();var p=d.split(" ");var o=p[0];if(n[o]!==undefined){b.push(m)}}catch(c){console.error("WebRTCommCall:updateMediaDescription(): rtpmap/fmtp format not supported")}}else{b.push(m)}}a.setAttributes(b)}else{throw"WebRTCommCall:updateMediaDescription(): bad arguments"}};WebRTCommCall.prototype.updateOpusMediaDescription=function(a,d){if(a instanceof MediaDescription&&typeof(d)==="string"){var c=undefined;var g=a.getAttributes();for(var k=0;k<g.length;k++){var m=g[k];if(m.getName()==="rtpmap"){try{var f=m.getValue().toLowerCase();if(f.indexOf("opus")>=0){var o=f.split(" ");c=o[0];break}}catch(e){console.error("WebRTCommCall:updateMediaDescription(): rtpmap/fmtp format not supported")}}}if(c){for(var h=0;h<g.length;h++){var m=g[h];if(m.getName()==="fmtp"){try{var l=m.getValue();var b=f.split(" ");var n=b[0];if(c===n){m.setValue(l+" "+d)}}catch(e){console.error("WebRTCommCall:updateMediaDescription(): rtpmap/fmtp format not supported")}}}}}else{throw"WebRTCommCall:updateMediaDescription(): bad arguments"}};WebRTCommCall.prototype.patchChromeIce=function(k,a){if(k instanceof SessionDescription){try{var b=k.getAttributes(false);if(b!=null){for(var g=0;g<b.length;g++){var h=b[g];if(h.getName()===a){try{var d=h.getValue().toLowerCase();if(d.indexOf("google-ice")>=0){c.remove(g);break}}catch(e){console.error("WebRTCommCall:updateMediaDescription(): rtpmap/fmtp format not supported")}}}}var l=k.getMediaDescriptions(false);for(var g=0;g<l.length;g++){var c=l[g].getAttributes();for(var f=0;f<c.length;f++){var h=c[f];if(h.getName()===a){try{var d=h.getValue().toLowerCase();if(d.indexOf("google-ice")>=0){c.remove(f);break}}catch(e){console.error("WebRTCommCall:updateMediaDescription(): rtpmap/fmtp format not supported")}}}}}catch(e){console.error("WebRTCommCall:patchChromeIce(): catched exception, exception:"+e);throw e}}else{throw"WebRTCommCall:patchChromeIce(): bad arguments"}};WebRTCommCall.prototype.removeMediaDescription=function(h,g){if(h instanceof SessionDescription){try{var j=h.getMediaDescriptions(false);for(var f=0;f<j.length;f++){var a=j[f];var k=a.getMedia();var l=k.getType();if(l===g){j.remove(f);break}}if(window.mozRTCPeerConnection){var e=h.getAttributes(false);for(var f=0;f<e.length;f++){var b=e[f];var d=b.getValue();if("BUNDLE sdparta_0 sdparta_1"===d){if("video"===g){b.setValue("BUNDLE sdparta_0");break}if("audio"===g){b.setValue("BUNDLE sdparta_1");break}}}}}catch(c){console.error("WebRTCommCall:removeMediaDescription(): catched exception, exception:"+c);throw c}}else{throw"WebRTCommCall:removeMediaDescription(): bad arguments"}};WebRTCommCall.prototype.forceTurnMediaRelay=function(j){if(j instanceof SessionDescription){try{var l=j.getMediaDescriptions(false);for(var g=0;g<l.length;g++){var a=l[g];var b=new Array();var e=a.getAttributes();for(var f=0;f<e.length;f++){var h=e[f];if(h.getName()==="candidate"){var m=h.getValue();var c=m.indexOf("typ relay")>0;if(c){b.push(h)}}else{b.push(h)}}a.setAttributes(b)}}catch(d){console.error("WebRTCommCall:forceTurnMediaRelay(): catched exception, exception:"+d);throw d}}else{throw"WebRTCommCall:forceTurnMediaRelay(): bad arguments"}};WebRTCommMessage=function(a,b){if((a instanceof WebRTCommClient)||(b instanceof WebRTCommCall)){this.id=undefined;this.webRTCommClient=a;this.webRTCommCall=b;this.connector=this.webRTCommClient.connector.createPrivateSessionConnector(this);this.text=undefined;this.from=undefined;this.to=undefined}else{throw"WebRTCommMessage:WebRTCommMessage(): bad arguments"}};WebRTCommMessage.prototype.getId=function(){return this.connector.getId()};WebRTCommMessage.prototype.getFrom=function(){return this.from};WebRTCommMessage.prototype.getTo=function(){return this.to};WebRTCommMessage.prototype.getText=function(){return this.text};WebRTCommMessage.prototype.getLinkedWebRTCommCall=function(){return this.webRTCommCall};WebRTCommClient=function(a){if(typeof a==="object"){this.id="WebRTCommClient"+Math.floor(Math.random()*2147483648);this.eventListener=a;this.configuration=undefined;this.connector=undefined;this.closePendingFlag=false}else{throw"WebRTCommClient:WebRTCommClient(): bad arguments"}};WebRTCommClient.prototype.SIP="SIP";WebRTCommClient.prototype.isOpened=function(){if(this.connector){return this.connector.isOpened()}else{return false}};WebRTCommClient.prototype.getConfiguration=function(){return this.configuration};WebRTCommClient.prototype.open=function(a){if(typeof(a)==="object"){if(this.isOpened()===false){if(this.checkConfiguration(a)===true){this.configuration=a;if(a.communicationMode===WebRTCommClient.prototype.SIP){this.connector=new PrivateJainSipClientConnector(this);this.connector.open(this.configuration.sip)}}else{console.error("WebRTCommClient:open(): bad configuration");throw"WebRTCommClient:open(): bad configuration"}}else{console.error("WebRTCommClient:open(): bad state, unauthorized action");throw"WebRTCommClient:open(): bad state, unauthorized action"}}else{console.error("WebRTCommClient:open(): bad argument, check API documentation");throw"WebRTCommClient:open(): bad argument, check API documentation"}};WebRTCommClient.prototype.close=function(){if(this.isOpened()){try{this.closePendingFlag=true;this.connector.close()}catch(a){console.error("WebRTCommClient:close(): catched exception:"+a);this.closePendingFlag=false;this.connector=undefined;if(this.eventListener.onWebRTCommClientClosedEvent!==undefined){var b=this;setTimeout(function(){try{b.eventListener.onWebRTCommClientClosedEvent(b)}catch(c){console.error("WebRTCommClient:onWebRTCommClientClosed(): catched exception in event listener:"+c)}},1)}}}};WebRTCommClient.prototype.sendMessage=function(d,c){try{if(this.isOpened()){var a=new WebRTCommMessage(this,undefined);a.to=d;a.text=c;a.connector.send();return a}else{console.error("WebRTCommClient:sendMessage(): bad state, unauthorized action");throw"WebRTCommClient:sendMessage(): bad state, unauthorized action"}}catch(b){console.error("WebRTCommClient:sendMessage(): catched exception:"+b);throw"WebRTCommClient:sendMessage(): catched exception:"+b}};WebRTCommClient.prototype.call=function(b,c){try{if(typeof(b)==="string"&&typeof(c)==="object"){if(this.isOpened()){var d=new WebRTCommCall(this);d.connector=this.connector.createPrivateSessionConnector(d);d.open(b,c);return d}else{console.error("WebRTCommClient:call(): bad state, unauthorized action");throw"WebRTCommClient:call(): bad state, unauthorized action"}}else{console.error("WebRTCommClient:call(): bad argument, check API documentation");throw"WebRTCommClient:call(): bad argument, check API documentation"}}catch(a){console.error("WebRTCommClient:call(): catched exception:"+a);throw a}};WebRTCommClient.prototype.checkConfiguration=function(b){var a=true;if(b.communicationMode!==undefined){if(b.communicationMode===WebRTCommClient.prototype.SIP){}else{a=false;console.error("WebRTCommClient:checkConfiguration(): unsupported communicationMode")}}else{a=false;console.error("WebRTCommClient:checkConfiguration(): missing configuration parameter communicationMode")}return a};WebRTCommClient.prototype.onPrivateClientConnectorOpenedEvent=function(){if(this.eventListener.onWebRTCommClientOpenedEvent!==undefined){var a=this;setTimeout(function(){try{a.eventListener.onWebRTCommClientOpenedEvent()}catch(b){console.error("WebRTCommClient:onPrivateClientConnectorOpenedEvent(): catched exception in event listener:"+b)}},1)}};WebRTCommClient.prototype.onPrivateClientConnectorOpenErrorEvent=function(a){try{this.close()}catch(b){}if(this.eventListener.onWebRTCommClientOpenErrorEvent!==undefined){var c=this;setTimeout(function(){try{c.eventListener.onWebRTCommClientOpenErrorEvent(a)}catch(d){console.error("WebRTCommClient:onPrivateClientConnectorOpenErrorEvent(): catched exception in event listener:"+d)}},1)}};WebRTCommClient.prototype.onPrivateClientConnectorClosedEvent=function(){var c=this.isOpened()||this.closePendingFlag;try{if(this.closePendingFlag===false){this.close()}else{this.connector=undefined}}catch(a){}if(c&&(this.eventListener.onWebRTCommClientClosedEvent!==undefined)){var b=this;setTimeout(function(){try{b.eventListener.onWebRTCommClientClosedEvent()}catch(d){console.error("WebRTCommClient:onPrivateClientConnectorClosedEvent(): catched exception in event listener:"+d)}},1)}else{if(!c&&(this.eventListener.onWebRTCommClientOpenErrorEvent!==undefined)){var b=this;setTimeout(function(){try{b.eventListener.onWebRTCommClientOpenErrorEvent("Connection to WebRTCommServer has failed")}catch(d){console.error("WebRTCommClient:onWebRTCommClientOpenErrorEvent(): catched exception in event listener:"+d)}},1)}}};WebRTCommClientEventListenerInterface=function(){};WebRTCommClientEventListenerInterface.prototype.onWebRTCommClientOpenedEvent=function(){throw"WebRTCommClientEventListenerInterface:onWebRTCommClientOpenedEvent(): not implemented;"};WebRTCommClientEventListenerInterface.prototype.onWebRTCommClientOpenErrorEvent=function(a){throw"WebRTCommClientEventListenerInterface:onWebRTCommClientOpenErrorEvent(): not implemented;"};WebRTCommClientEventListenerInterface.prototype.onWebRTCommClientClosedEvent=function(){throw"WebRTCommClientEventListenerInterface:onWebRTCommClientClosedEvent(): not implemented;"};WebRTCommCallEventListenerInterface=function(){};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallOpenedEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallOpenedEvent(): not implemented;"};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallInProgressEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallInProgressEvent(): not implemented;"};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallOpenErrorEvent=function(b,a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallOpenErrorEvent(): not implemented;"};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallRingingEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallRingingEvent(): not implemented;"};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallRingingBackEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallRingingBackEvent(): not implemented;"};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallHangupEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallHangupEvent(): not implemented;"};WebRTCommCallEventListenerInterface.prototype.onWebRTCommCallCanceledEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommCallCanceledEvent(): not implemented;"};WebRTCommMessageEventListenerInterface=function(){};WebRTCommMessageEventListenerInterface.prototype.onWebRTCommMessageReceivedEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommMessageReceivedEvent(): not implemented;"};WebRTCommMessageEventListenerInterface.prototype.onWebRTCommMessageSentEvent=function(a){throw"WebRTCommCallEventListenerInterface:onWebRTCommMessageSentEvent(): not implemented;"};WebRTCommMessageEventListenerInterface.prototype.onWebRTCommMessageSendErrorEvent=function(b,a){throw"WebRTCommCallEventListenerInterface:onWebRTCommMessageSendErrorEvent(): not implemented;"};